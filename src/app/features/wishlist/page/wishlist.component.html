<app-navbar></app-navbar>

<div class="container-fluid p-0 m-0 main-bg-clr">
  <div class="container py-4 py-md-5" [class.rtl]="currentLang() === 'ar'">

    <div
      class="wishlist-header d-flex flex-column flex-md-row align-items-start align-items-md-center justify-content-between mb-4 mb-md-5 gap-3">

      <h1 class="fs-2 fw-bold mb-0 text-primary" [attr.aria-label]="'WISHLIST.title' | translate">
        <i class="pi pi-heart-fill me-2 primary-text-clr fs-4"></i>
        {{'WISHLIST.title' | translate}}
      </h1>

      @if (wishlistItems().length > 0 && !isLoading()) {
      <div class="wishlist-count">
        <span class="badge rounded-pill primary-bg-clr text-white fs-6 px-4 py-2 fw-semibold">
          {{ wishlistItems().length }} {{'WISHLIST.items' | translate}}
        </span>
      </div>
      }
    </div>

    <div class="services-content w-100">

      @if (isLoading()) {
      <div class="loading-container w-100 text-center py-5">
        <div class="spinner-border primary-text-clr" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-3 fs-5 fw-medium">{{'COMMON.LOADING' | translate}}</p>
      </div>
      }

      @else if (wishlistItems().length === 0) {
      <div class="empty-wishlist w-100 text-center py-5 border rounded-4 bg-white">
        <div class="empty-icon mb-4">
          <i class="pi pi-heart grey-clr" style="font-size: 5rem; color: #ced4da;"></i>
        </div>
        <h3 class="empty-title fw-bold mb-2 fs-2">{{'WISHLIST.empty.title' | translate}}</h3>
        <p class="empty-description text-muted mb-4 fs-5">{{'WISHLIST.empty.description' | translate}}</p>
        <button class="btn btn-primary primary-bg-clr px-5 py-3 fs-5 fw-medium shadow-sm" routerLink="/all-services">
          <i class="pi pi-search me-2"></i>
          {{'WISHLIST.empty.browse' | translate}}
        </button>
      </div>
      }

      <div class="row row-cols-1 row-cols-sm-2 row-cols-md-2 row-cols-lg-3 row-cols-xl-3 g-4 mt-3">
        @for (service of wishlistItems(); track trackByServiceId($index, service)) {

        <div class="col" [class.rtl-layout]="currentLang() === 'ar'">
          <div class="card wishlist-card h-100" [attr.aria-label]="service.name"
            (click)="navigateToServiceDetails(service.id)">

            <div class="card-img-top-container position-relative">
              <img [src]="getServiceImage(service)" [alt]="service.name" class="service-image w-100" loading="lazy" />

              @if (service.tags) {
              <span class="service-tag badge bg-info text-dark position-absolute top-0 start-0 m-2">
                {{ service.tags }}
              </span>
              }

              <button class="btn-remove position-absolute" (click)="removeFromWishlist(service.id, $event)"
                [disabled]="isRemoving()[service.id]" [attr.aria-label]="'wishlist.remove' | translate">
                @if (isRemoving()[service.id]) {
                <span class="spinner-border spinner-border-sm" aria-hidden="true"></span>
                } @else {
                <i class="pi pi-trash"></i>
                }
              </button>
            </div>

            <div class="card-body d-flex flex-column justify-content-between gap-3">

              <div>
                <h3 class="service-title fw-semibold text-truncate mb-1" [class.rtl-text]="currentLang() === 'ar'">
                  {{ service.name }}
                </h3>
                <p class="service-description text-muted fs-6" [class.rtl-text]="currentLang() === 'ar'">
                  {{ service.description }}
                </p>
              </div>

              <div class="d-flex justify-content-between align-items-center pt-2 border-top">
                <div class="price-group d-flex align-items-center gap-2">
                  <span class="price-offer fw-bolder fs-5 primary-text-clr">${{ service.price }}</span>
                  @if (hasDiscount(service)) {
                  <span class="orignal-price text-muted text-decoration-line-through fs-6">
                    ${{ service.priceBefore }}
                  </span>
                  }
                </div>

                <div class="rating-container d-flex align-items-center gap-1">
                  <i class="pi pi-star-fill text-warning"></i>
                  <span class="fw-bold me-1">{{ service.rate | number:'1.1-1' }}</span>
                  <span class="review-count text-muted">({{ service.rateCount || 0 }})</span>
                </div>
              </div>

              <div class="button-container d-flex gap-2 w-100 mt-2" [class.flex-row-reverse]="currentLang() === 'ar'">
                <button class="btn btn-primary card-btn py-2 flex-grow-1 fw-medium"
                  [attr.aria-label]="'Buy now ' + service.name" (click)="onBuyNow(service, $event)">
                  {{ 'all-services.buy-now' | translate }}
                </button>
                <button class="btn btn-outline-primary card-btn py-2 flex-grow-1 fw-medium"
                  [attr.aria-label]="'Add to cart ' + service.name" (click)="onAddToCart(service, $event)">
                  <i class="pi pi-shopping-cart me-1"></i>
                  {{ 'all-services.add-to-cart' | translate }}
                </button>
              </div>
            </div>
          </div>
        </div>
        }
      </div>

    </div>
  </div>
</div>

<app-footer></app-footer>