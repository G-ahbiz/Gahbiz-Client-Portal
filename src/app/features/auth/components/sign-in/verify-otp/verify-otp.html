<div class="bg-[#005DB5] dark:bg-gray-900 min-h-screen flex items-center justify-center p-4">
  <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-8 max-w-md w-full">
    <!-- Heading -->
    <h1 class="text-2xl font-bold text-center text-gray-800 dark:text-white mb-6">
      {{ 'AUTH.PASSWORD_RESET' | translate }}
    </h1>

    <!-- Instruction text -->
    <p class="text-gray-600 dark:text-gray-300 text-center mb-8">
      {{ 'AUTH.WE_SENT_CODE' | translate }}
    </p>

    <!-- Error Alert -->
    @if (errorMessage() && !successMessage()) {
    <div
      class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md p-4 mb-6"
    >
      <div class="flex">
        <div class="flex-shrink-0">
          <mat-icon class="h-5 w-5 text-red-400">error</mat-icon>
        </div>
        <div class="ml-3 flex-1">
          <p class="text-sm text-red-800 dark:text-red-200">{{ errorMessage() }}</p>
        </div>
        <div class="ml-auto pl-3">
          <div class="-mx-1.5 -my-1.5">
            <button
              (click)="clearError()"
              class="inline-flex bg-red-50 dark:bg-red-900/30 rounded-md p-1.5 text-red-500 dark:text-red-400 hover:bg-red-100 dark:hover:bg-red-900/50 transition-colors duration-200"
              aria-label="Dismiss error message"
            >
              <span class="sr-only">Dismiss</span>
              <mat-icon class="h-5 w-5">close</mat-icon>
            </button>
          </div>
        </div>
      </div>
    </div>
    }

    <!-- Success Alert -->
    @if (successMessage() && !errorMessage()) {
    <div
      class="bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-md p-4 mb-6"
    >
      <div class="flex">
        <div class="flex-shrink-0">
          <mat-icon class="h-5 w-5 text-green-400">check_circle</mat-icon>
        </div>
        <div class="ml-3 flex-1">
          <p class="text-sm text-green-800 dark:text-green-200">{{ successMessage() }}</p>
        </div>
        <div class="ml-auto pl-3">
          <div class="-mx-1.5 -my-1.5">
            <button
              (click)="clearSuccess()"
              class="inline-flex bg-green-50 dark:bg-green-900/30 rounded-md p-1.5 text-green-500 dark:text-green-400 hover:bg-green-100 dark:hover:bg-green-900/50 transition-colors duration-200"
              aria-label="Dismiss success message"
            >
              <span class="sr-only">Dismiss</span>
              <mat-icon class="h-5 w-5">close</mat-icon>
            </button>
          </div>
        </div>
      </div>
    </div>
    }

    <!-- Code input fields -->
    <form [formGroup]="verifyPassForm" (ngSubmit)="onSubmit()">
      <div class="flex justify-center space-x-4 mb-8">
        <input
          type="text"
          maxlength="1"
          class="w-14 h-14 border-2 border-gray-300 dark:border-gray-600 rounded-lg text-3xl text-center focus:border-blue-500 dark:focus:border-blue-400 focus:outline-none bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
          [class.border-red-500]="getFieldError('code')"
          autofocus
          (input)="onOtpInput($event, 0)"
          (keydown)="onOtpKeyDown($event, 0)"
          [value]="verifyPassForm.get('code')?.value?.charAt(0) || ''"
        />
        <input
          type="text"
          maxlength="1"
          class="w-14 h-14 border-2 border-gray-300 dark:border-gray-600 rounded-lg text-3xl text-center focus:border-blue-500 dark:focus:border-blue-400 focus:outline-none bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
          [class.border-red-500]="getFieldError('code')"
          (input)="onOtpInput($event, 1)"
          (keydown)="onOtpKeyDown($event, 1)"
          [value]="verifyPassForm.get('code')?.value?.charAt(1) || ''"
        />
        <input
          type="text"
          maxlength="1"
          class="w-14 h-14 border-2 border-gray-300 dark:border-gray-600 rounded-lg text-3xl text-center focus:border-blue-500 dark:focus:border-blue-400 focus:outline-none bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
          [class.border-red-500]="getFieldError('code')"
          (input)="onOtpInput($event, 2)"
          (keydown)="onOtpKeyDown($event, 2)"
          [value]="verifyPassForm.get('code')?.value?.charAt(2) || ''"
        />
        <input
          type="text"
          maxlength="1"
          class="w-14 h-14 border-2 border-gray-300 dark:border-gray-600 rounded-lg text-3xl text-center focus:border-blue-500 dark:focus:border-blue-400 focus:outline-none bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
          [class.border-red-500]="getFieldError('code')"
          (input)="onOtpInput($event, 3)"
          (keydown)="onOtpKeyDown($event, 3)"
          [value]="verifyPassForm.get('code')?.value?.charAt(3) || ''"
        />
        <input
          type="text"
          maxlength="1"
          class="w-14 h-14 border-2 border-gray-300 dark:border-gray-600 rounded-lg text-3xl text-center focus:border-blue-500 dark:focus:border-blue-400 focus:outline-none bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
          [class.border-red-500]="getFieldError('code')"
          (input)="onOtpInput($event, 4)"
          (keydown)="onOtpKeyDown($event, 4)"
          [value]="verifyPassForm.get('code')?.value?.charAt(4) || ''"
        />
        <input
          type="text"
          maxlength="1"
          class="w-14 h-14 border-2 border-gray-300 dark:border-gray-600 rounded-lg text-3xl text-center focus:border-blue-500 dark:focus:border-blue-400 focus:outline-none bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
          [class.border-red-500]="getFieldError('code')"
          (input)="onOtpInput($event, 5)"
          (keydown)="onOtpKeyDown($event, 5)"
          [value]="verifyPassForm.get('code')?.value?.charAt(5) || ''"
        />
      </div>

      @if (getFieldError('code')) {
      <div class="text-red-500 dark:text-red-400 text-sm mt-1">
        <span>{{ getFieldError('code') }}</span>
      </div>
      }

      <!-- Resend code link -->
      <p class="text-gray-600 dark:text-gray-300 text-center mb-8 pt-2">
        {{ 'AUTH.DIDNT_RECEIVE_CODE' | translate }}
        <a (click)="resendCode()" class="text-blue-600 dark:text-blue-400 hover:underline">{{
          'AUTH.CLICK_TO_RESEND' | translate
        }}</a>
      </p>

      <!-- Continue button -->
      <app-button
        [label]="'AUTH.CONTINUE' | translate"
        [disabled]="verifyPassForm.invalid || isLoading()"
        [loading]="isLoading()"
        [loadingText]="'AUTH.VERIFYING' | translate"
        type="submit"
      >
      </app-button>
    </form>
    <!-- Back to login link -->
    <div class="text-center pt-4">
      <a
        [routerLink]="['/auth/sign-in']"
        class="text-blue-600 dark:text-blue-400 hover:underline"
        >{{ 'AUTH.BACK_TO_LOGIN' | translate }}</a
      >
    </div>
  </div>
</div>
