<!-- Error Alert -->
@if (errorMessage() && !successMessage()) {
<div
  class="fixed top-4 right-4 z-50 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md p-4 max-w-md"
>
  <div class="flex">
    <div class="flex-shrink-0">
      <mat-icon class="h-5 w-5 text-red-400">error</mat-icon>
    </div>
    <div class="ml-3 flex-1">
      <p class="text-sm text-red-800 dark:text-red-200">{{ errorMessage() }}</p>
    </div>
    <div class="ml-auto pl-3">
      <div class="-mx-1.5 -my-1.5">
        <button
          (click)="clearError()"
          class="inline-flex bg-red-50 dark:bg-red-900/30 rounded-md p-1.5 text-red-500 dark:text-red-400 hover:bg-red-100 dark:hover:bg-red-900/50 transition-colors duration-200"
          aria-label="Dismiss error message"
        >
          <span class="sr-only">Dismiss</span>
          <mat-icon class="h-5 w-5">close</mat-icon>
        </button>
      </div>
    </div>
  </div>
</div>
}

<!-- Success Alert -->
@if (successMessage() && !errorMessage()) {
<div
  class="fixed top-4 right-4 z-50 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-md p-4 max-w-md"
>
  <div class="flex">
    <div class="flex-shrink-0">
      <mat-icon class="h-5 w-5 text-green-400">check_circle</mat-icon>
    </div>
    <div class="ml-3 flex-1">
      <p class="text-sm text-green-800 dark:text-green-200">{{ successMessage() }}</p>
    </div>
    <div class="ml-auto pl-3">
      <div class="-mx-1.5 -my-1.5">
        <button
          (click)="clearSuccess()"
          class="inline-flex bg-green-50 dark:bg-green-900/30 rounded-md p-1.5 text-green-500 dark:text-green-400 hover:bg-green-100 dark:hover:bg-green-900/50 transition-colors duration-200"
          aria-label="Dismiss success message"
        >
          <span class="sr-only">Dismiss</span>
          <mat-icon class="h-5 w-5">close</mat-icon>
        </button>
      </div>
    </div>
  </div>
</div>
}

<!-- Step 1: OTP Verification -->
@if (currentStep() === 'verify-otp') {
<app-verify-otp [userId]="userId()" (otpVerified)="onOtpVerified($event)"></app-verify-otp>
}

<!-- Step 2: New Password -->
@if (currentStep() === 'new-password') {
<app-new-password
  [userId]="userId()"
  [otpCode]="otpCode()"
  [isLoading]="isLoading()"
  (passwordSubmitted)="onPasswordSubmitted($event)"
  (goBack)="goBackToOtp()"
></app-new-password>
}
