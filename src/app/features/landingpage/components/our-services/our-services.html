<div class="container-fluid px-1 py-4 p-lg-5 our-services">
  <div class="our-services-header w-100 d-flex flex-column justify-content-center align-items-center text-center mb-4">
    <p class="our-services-subtitle txt-clr mb-1">
      {{ 'our-services.subtitle' | translate }}
    </p>
    <h1 class="our-services-title fw-medium">
      <span class="txt-clr">{{ 'our-services.title1' | translate }}</span>
      <span class="text-highlight">{{ 'our-services.title2' | translate }}</span>
    </h1>
    <div class="decoration-underline">
      <div class="h-100 orange-bg-clr w-50"></div>
      <div class="h-100 white-bg-clr w-50"></div>
    </div>
  </div>

  @if (services$ | async; as services) {
    @if (isLoading) {
      <div class="slider-loading">
        <div class="spinner"></div>
      </div>
    } @else {
      @if (services.length === 0) {
        <div class="slider-empty txt-clr text-center">
          <p class="fs-5 mb-4">{{ 'our-services.noServices' | translate }}</p>
          <button class="btn explore-button orange-bg-clr d-flex justify-content-center align-items-center gap-3 px-5 py-3"
            (click)="retryLoadServices()">
            <span class="fw-semibold fs-6 text-nowrap">{{ 'our-services.tryAgain' | translate }}</span>
            <i class="bi bi-arrow-clockwise" aria-hidden="true"></i>
          </button>
        </div>
      } @else {
        <div class="our-slider">
          <div class="slider-viewport mx-auto" 
            tabindex="0" 
            (keydown.arrowleft)="navigatePrev()"
            (keydown.arrowright)="navigateNext()" 
            (touchstart)="onTouchStart($event)" 
            (touchend)="onTouchEnd($event)"
            (focusin)="stopAutoplay()" 
            (focusout)="startAutoplay()" 
            role="list"
            [attr.aria-label]="'our-services.sliderAriaLabel' | translate">
            
            @for (s of services; track s.category; let i = $index) {
              <div class="slide" 
                [ngStyle]="getSlideStyle(i)"
                [class.slide-active]="i === currentIndex" 
                [attr.data-index]="i" 
                role="listitem">
                
                <!-- Optimized image with NgOptimizedImage -->
                <div class="image-wrapper" (click)="navigateToCategory(s.category)">
                  <img 
                    [ngSrc]="getOptimizedImage(s.image, i)" 
                    [alt]="s.title" 
                    class="slide-image"
                    width="560"
                    height="300"
                    [priority]="i === 0"
                    (load)="onImageLoad($event)" />
                </div>

                <div class="details-card" (click)="navigateToCategory(s.category)">
                  <div class="details-left">
                    <div class="service-title">{{ s.title }}
                      <span class="service-count">
                        {{ 'our-services.serviceCount' | translate:{ count: s.serviceCount } }}
                      </span>
                    </div>
                    <div class="service-caption">{{ s.caption }}</div>
                  </div>

                  <div class="details-action" aria-hidden="true">
                    <div class="arrow-round"
                      [attr.aria-label]="'our-services.openService' | translate:{ serviceName: s.title }">
                      <i [class]="isArabic ? 'bi bi-arrow-left' : 'bi bi-arrow-right'"></i>
                    </div>
                  </div>
                </div>
              </div>
            }
          </div>

          <div class="slider-controls d-flex justify-content-between align-items-center">
            <button class="ctrl prev btn" (click)="navigatePrev()"
              [attr.aria-label]="'our-services.previousSlide' | translate" 
              (mouseenter)="stopAutoplay()"
              (mouseleave)="startAutoplay()">
              <i [class]="isArabic ? 'bi bi-arrow-right' : 'bi bi-arrow-left'"></i>
            </button>

            <button class="ctrl next btn" (click)="navigateNext()" 
              [attr.aria-label]="'our-services.nextSlide' | translate"
              (mouseenter)="stopAutoplay()" 
              (mouseleave)="startAutoplay()">
              <i [class]="isArabic ? 'bi bi-arrow-left' : 'bi bi-arrow-right'"></i>
            </button>
          </div>
        </div>

        <div class="explore-button-container w-100 d-flex justify-content-center align-items-center mt-5">
          <button class="btn explore-button orange-bg-clr d-flex justify-content-center align-items-center gap-3 px-5 py-3"
            (click)="navigateToAllServices()">
            <span class="fw-semibold fs-6 text-nowrap">{{ 'our-services.explore' | translate }}</span>
            <i [class]="isArabic ? 'bi bi-arrow-left' : 'bi bi-arrow-right'"></i>
          </button>
        </div>
      }
    }
  }
</div>